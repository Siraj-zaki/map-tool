import{b as z,c as B,u as W,r as t,j as e}from"./index-CldepO61.js";import{r as H}from"./index-C1hE1Gfb.js";import{E as O}from"./ElevationProfile-DQXevQii.js";import{R as V,T as q,W as S,M as A,P as G,a as X}from"./WeatherForecast-PDUQIQA5.js";function U(){const{id:y}=z(),[C]=B(),n=y||C.get("route"),{t:c}=W(),[s,v]=t.useState(null),[N,u]=t.useState(!0),[d,x]=t.useState(null),[w,a]=t.useState(null),[r,f]=t.useState(!1),[R,m]=t.useState(!1),[i,k]=t.useState("gold"),[h,E]=t.useState(null),[T,g]=t.useState(),[F,P]=t.useState(null),b=t.useRef(null);t.useEffect(()=>{if(!n){u(!1);return}(async()=>{try{const l=await H.getById(Number(n));l.success?v(l.route):x("Route not found")}catch(l){x("Failed to load route"),console.error(l)}finally{u(!1)}})()},[n]);const I=t.useCallback(o=>{g(o?o.distance:void 0)},[]),M=t.useCallback(o=>{P(o?{lng:o.lng,lat:o.lat}:null)},[]),D=t.useCallback(o=>{console.log("[PublicView] handlePoiClick called:",o.name),a(o),b.current&&b.current(o)},[]),L=()=>{document.fullscreenElement?(document.exitFullscreen(),f(!1)):(document.documentElement.requestFullscreen(),f(!0))};if(N)return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-[#0b1215] text-gray-400",children:[e.jsx("i",{className:"fas fa-mountain fa-spin text-4xl text-[#088d95] mb-4"}),e.jsx("span",{children:c("routeLoading")})]});if(d||!s)return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-[#0b1215] text-gray-400",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-500 mb-4"}),e.jsx("span",{children:d||c("noRouteSpecified")})]});const p=(s.startPoint[1]+s.endPoint[1])/2,j=(s.startPoint[0]+s.endPoint[0])/2;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#0b1215]",children:[e.jsx(V,{route:s,showWeather:!0,showDownloadButton:!0,onDownloadClick:()=>m(!0)}),e.jsxs("div",{className:"flex-1 relative h-full",children:[e.jsx("div",{style:{position:"absolute",top:"12px",left:"60px",zIndex:40},children:e.jsx(q,{tourType:i,onTourTypeChange:k,selectedStage:h,onStageSelect:E})}),e.jsx("div",{style:{position:"absolute",top:"12px",right:"60px",zIndex:40},children:e.jsx(S,{lat:p,lng:j,locationName:s.name||"Route"})}),e.jsx(A,{route:s,tourType:i,selectedStage:h,onPositionChange:I,onPoiClick:a,isFullscreen:r,highlightPosition:F}),e.jsx("button",{onClick:L,className:"absolute top-3 left-3 z-50 w-10 h-10 flex items-center justify-center bg-[#080e11] border border-[#1e2a33] rounded-lg text-gray-400 hover:text-white hover:bg-[#088d95] hover:border-[#088d95] transition-all",children:e.jsx("i",{className:`fas fa-${r?"compress":"expand"}`})}),e.jsx(G,{poi:w,routeStartPoint:s.startPoint,onClose:()=>a(null)})]}),!r&&e.jsxs("div",{className:"flex flex-col bg-[#0b1215]",children:[e.jsx(O,{route:s,pois:s.pois,tourType:i,onPositionChange:M,highlightDistance:T,onPoiClick:D}),e.jsx("div",{className:"md:hidden px-4 py-2 bg-[#080e11] border-t border-[#1e2a33]",children:e.jsx(S,{lat:p,lng:j,locationName:s.name||"Route"})})]}),e.jsx(X,{isOpen:R,onClose:()=>m(!1),featureName:"GPX Download"})]})}export{U as default};
