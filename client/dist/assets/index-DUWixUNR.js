const d=new Map;async function u(t,e,n=300*1e3){const o=d.get(t);if(o&&o.expiry>Date.now())return o.data;const a=await e();return d.set(t,{data:a,expiry:Date.now()+n}),a}function l(t){t?d.delete(t):d.clear()}const c="/api",w={login:async(t,e)=>(await fetch(`${c}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:e})})).json(),logout:async()=>{const t=await fetch(`${c}/auth/logout`,{method:"POST",credentials:"include"});return l(),t.json()},getProfile:async()=>(await fetch(`${c}/auth/profile`,{credentials:"include"})).json()},m={getAll:async()=>u("routes:all",async()=>(await fetch(`${c}/routes`)).json(),120*1e3),getById:async t=>u(`routes:${t}`,async()=>(await fetch(`${c}/routes/${t}`)).json(),300*1e3),create:async t=>{const e=await fetch(`${c}/routes`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return l("routes:all"),e.json()},update:async(t,e)=>{const n=await fetch(`${c}/routes/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return l("routes:all"),l(`routes:${t}`),n.json()},delete:async t=>{const e=await fetch(`${c}/routes/${t}`,{method:"DELETE",credentials:"include"});return l("routes:all"),l(`routes:${t}`),e.json()},getByIdFresh:async t=>(l(`routes:${t}`),(await fetch(`${c}/routes/${t}`)).json())},j={getByRoute:async(t,e,n)=>{const o=`gpx:${t}:${e||"all"}:${n||"all"}`;return u(o,async()=>{let a=`${c}/gpx/${t}`;const i=new URLSearchParams;return e&&i.append("tour_type",e),n&&i.append("start_point",n),i.toString()&&(a+=`?${i}`),(await fetch(a)).json()},600*1e3)},download:t=>{window.open(`${c}/gpx/download/${t}`,"_blank")},getStartPoints:async t=>u(`gpx:startPoints:${t}`,async()=>(await fetch(`${c}/gpx/start-points/${t}`)).json(),600*1e3)},$="pk.eyJ1IjoicHVuY2hpbmdtYW4iLCJhIjoiY2p1cjcyMmh2M3NpZDQ5bnEwMDV6ZTE1OSJ9.ef8y6l9fsKFMX91m_Rt2ng",P=async(t,e,n,o="walking")=>{const a=[t,...e,n].map(s=>s.join(",")).join(";"),i=`directions:${o}:${a}`;return u(i,async()=>{const s=`https://api.mapbox.com/directions/v5/mapbox/${o}/${a}?geometries=geojson&access_token=${$}&overview=full`;return(await fetch(s)).json()},1800*1e3)},x=async t=>{let n=t;if(t.length>100){const o=Math.ceil(t.length/100);n=t.filter((a,i)=>i%o===0),n[n.length-1]!==t[t.length-1]&&n.push(t[t.length-1])}try{const o=n.map(([r,h])=>({latitude:h,longitude:r})),a=await fetch("https://api.open-elevation.com/api/v1/lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:o})});if(!a.ok)throw new Error("Elevation API failed");const s=(await a.json()).results.map(r=>r.elevation);let p=s[0],f=s[0],g=0,y=0;for(let r=1;r<s.length;r++){const h=s[r]-s[r-1];h>0?g+=h:y+=Math.abs(h),s[r]>p&&(p=s[r]),s[r]<f&&(f=s[r])}return{elevations:s,highestPoint:Math.round(p),lowestPoint:Math.round(f),totalAscent:Math.round(g),totalDescent:Math.round(y)}}catch(o){return console.error("Failed to fetch elevation data:",o),{elevations:[],highestPoint:0,lowestPoint:0,totalAscent:0,totalDescent:0}}};function M(t){const e=Math.floor(t/3600),n=Math.floor(t%3600/60);return`${e}h ${n}m`}export{w as a,x as b,j as c,M as f,P as g,m as r};
