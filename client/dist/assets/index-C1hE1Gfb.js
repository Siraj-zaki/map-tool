const d=new Map;async function p(t,e,n=300*1e3){const s=d.get(t);if(s&&s.expiry>Date.now())return s.data;const r=await e();return d.set(t,{data:r,expiry:Date.now()+n}),r}function i(t){t?d.delete(t):d.clear()}const c="/api",w={login:async(t,e)=>(await fetch(`${c}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:e})})).json(),logout:async()=>{const t=await fetch(`${c}/auth/logout`,{method:"POST",credentials:"include"});return i(),t.json()},getProfile:async()=>(await fetch(`${c}/auth/profile`,{credentials:"include"})).json()},$={getAll:async()=>p("routes:all",async()=>(await fetch(`${c}/routes`)).json(),120*1e3),getById:async t=>p(`routes:${t}`,async()=>(await fetch(`${c}/routes/${t}`)).json(),300*1e3),create:async t=>{const e=await fetch(`${c}/routes`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return i("routes:all"),e.json()},update:async(t,e)=>{const n=await fetch(`${c}/routes/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return i("routes:all"),i(`routes:${t}`),n.json()},delete:async t=>{const e=await fetch(`${c}/routes/${t}`,{method:"DELETE",credentials:"include"});return i("routes:all"),i(`routes:${t}`),e.json()},getByIdFresh:async t=>(i(`routes:${t}`),(await fetch(`${c}/routes/${t}`)).json())},m="pk.eyJ1IjoicHVuY2hpbmdtYW4iLCJhIjoiY2p1cjcyMmh2M3NpZDQ5bnEwMDV6ZTE1OSJ9.ef8y6l9fsKFMX91m_Rt2ng",j=async(t,e,n,s="walking")=>{const r=[t,...e,n].map(o=>o.join(",")).join(";"),u=`directions:${s}:${r}`;return p(u,async()=>{const o=`https://api.mapbox.com/directions/v5/mapbox/${s}/${r}?geometries=geojson&access_token=${m}&overview=full`;return(await fetch(o)).json()},1800*1e3)},P=async t=>{let n=t;if(t.length>100){const s=Math.ceil(t.length/100);n=t.filter((r,u)=>u%s===0),n[n.length-1]!==t[t.length-1]&&n.push(t[t.length-1])}try{const s=n.map(([a,l])=>({latitude:l,longitude:a})),r=await fetch("https://api.open-elevation.com/api/v1/lookup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:s})});if(!r.ok)throw new Error("Elevation API failed");const o=(await r.json()).results.map(a=>a.elevation);let h=o[0],f=o[0],y=0,g=0;for(let a=1;a<o.length;a++){const l=o[a]-o[a-1];l>0?y+=l:g+=Math.abs(l),o[a]>h&&(h=o[a]),o[a]<f&&(f=o[a])}return{elevations:o,highestPoint:Math.round(h),lowestPoint:Math.round(f),totalAscent:Math.round(y),totalDescent:Math.round(g)}}catch(s){return console.error("Failed to fetch elevation data:",s),{elevations:[],highestPoint:0,lowestPoint:0,totalAscent:0,totalDescent:0}}};function M(t){const e=Math.floor(t/3600),n=Math.floor(t%3600/60);return`${e}h ${n}m`}export{w as a,P as b,M as f,j as g,$ as r};
