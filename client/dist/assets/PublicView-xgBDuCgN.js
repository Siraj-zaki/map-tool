import{b as D,c as G,u as L,r as t,j as e}from"./index-xMwKD10N.js";import{r as W}from"./index-DUWixUNR.js";import{E as B}from"./ElevationProfile-DP2kmXtP.js";import{R as z,W as j,M as H,P as V,G as q}from"./WeatherForecast-DREyolUz.js";function K(){const{id:C}=D(),[S]=G(),n=C||S.get("route"),{t:i}=L(),[s,y]=t.useState(null),[v,c]=t.useState(!0),[u,d]=t.useState(null),[w,a]=t.useState(null),[r,x]=t.useState(!1),[N,f]=t.useState(!1),[h,R]=t.useState("gold"),[k,m]=t.useState(),[E,g]=t.useState(null),p=t.useRef(null);t.useEffect(()=>{if(!n){c(!1);return}(async()=>{try{const l=await W.getById(Number(n));l.success?y(l.route):d("Route not found")}catch(l){d("Failed to load route"),console.error(l)}finally{c(!1)}})()},[n]);const T=t.useCallback(o=>{m(o?o.distance:void 0)},[]),F=t.useCallback(o=>{g(o?{lng:o.lng,lat:o.lat}:null)},[]),I=t.useCallback(o=>{console.log("[PublicView] handlePoiClick called:",o.name),a(o),p.current&&p.current(o)},[]),M=()=>{document.fullscreenElement?(document.exitFullscreen(),x(!1)):(document.documentElement.requestFullscreen(),x(!0))};if(v)return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-[#0b1215] text-gray-400",children:[e.jsx("i",{className:"fas fa-mountain fa-spin text-4xl text-[#088d95] mb-4"}),e.jsx("span",{children:i("routeLoading")})]});if(u||!s)return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-[#0b1215] text-gray-400",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-4xl text-red-500 mb-4"}),e.jsx("span",{children:u||i("noRouteSpecified")})]});const b=(s.startPoint[1]+s.endPoint[1])/2,P=(s.startPoint[0]+s.endPoint[0])/2;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#0b1215]",children:[e.jsx(z,{route:s,tourType:h,onTourTypeChange:R,showWeather:!0,showTourSelector:!0,showDownloadButton:!0,onDownloadClick:()=>f(!0)}),e.jsxs("div",{className:"flex-1 relative h-full",children:[e.jsx("div",{style:{position:"absolute",top:"16px",left:"60px",right:"60px",zIndex:40,maxWidth:"calc(100% - 60px)"},children:e.jsx(j,{lat:b,lng:P,locationName:s.name||"Route"})}),e.jsx(H,{route:s,tourType:h,onPositionChange:T,onPoiClick:a,isFullscreen:r,highlightPosition:E}),e.jsx("button",{onClick:M,className:"absolute top-3 left-3 z-50 w-10 h-10 flex items-center justify-center bg-[#080e11] border border-[#1e2a33] rounded-lg text-gray-400 hover:text-white hover:bg-[#088d95] hover:border-[#088d95] transition-all",children:e.jsx("i",{className:`fas fa-${r?"compress":"expand"}`})}),e.jsx(V,{poi:w,routeStartPoint:s.startPoint,onClose:()=>a(null)})]}),!r&&e.jsxs("div",{className:"flex flex-col bg-[#0b1215]",children:[e.jsx(B,{route:s,pois:s.pois,onPositionChange:F,highlightDistance:k,onPoiClick:I}),e.jsx("div",{className:"md:hidden px-4 py-2 bg-[#080e11] border-t border-[#1e2a33]",children:e.jsx(j,{lat:b,lng:P,locationName:s.name||"Route"})})]}),N&&e.jsx(q,{onClose:()=>f(!1),routeId:s.id})]})}export{K as default};
